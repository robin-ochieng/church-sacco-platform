# P1.10 Implementation Summary: Seed & Fixtures

## üéØ Objective
Establish a robust, repeatable database seeding process to support local development and end-to-end (E2E) testing. The seed data must provide a realistic snapshot of the SACCO's operations, including multiple branches, members with history, and various transaction types.

## üõ†Ô∏è Implementation Details

### 1. Enhanced Seed Script (`db/seeds/index.ts`)
The seed script was refactored to ensure **idempotency** (repeatability) using `upsert` operations. This allows developers to run `pnpm db:seed` multiple times without encountering "Unique constraint failed" errors.

**Key Data Generated:**
- **Branches:** 2 branches (`branch-a`, `branch-b`).
- **Users & Members:** 
  - 1 Admin (`admin@ackthiboro.com`)
  - 1 Teller (`teller@ackthiboro.com`)
  - 16 Members (8 per branch), with emails like `member001@branch-a.com`.
- **Activity History:**
  - The first 4 members of each branch are set to have joined > 6 months ago.
  - These members have generated **Savings Deposits** and **Monthly Charges** for the last 3 months.
- **Suspense Items:**
  - 2 M-Pesa messages in `SUSPENSE` status (`SUSPENSE001`, `SUSPENSE002`) for testing reconciliation workflows.

### 2. Verification Test Suite (`apps/api/test/seed-verification.e2e-spec.ts`)
A dedicated E2E test file was created to validate that the seed data is correctly loaded and accessible via the API.

**Tests Included:**
- **Health Check:** Verifies API availability.
- **Authentication:** Confirms that seeded users (e.g., `member001@branch-a.com`) can log in with the default password (`Password123!`).
- **Data Access:** Verifies that logged-in members can fetch their statements.
- **Transaction Integrity:** Checks for the presence of specific transaction types (`SAVINGS_DEPOSIT`, `MONTHLY_CHARGE`) and verifies receipt generation.

## üöÄ Usage

### Running the Seed
```bash
pnpm db:seed
```

### Verifying the Seed
To run the verification tests against the currently seeded database (without resetting it):

```bash
cd apps/api
npx jest test/seed-verification.e2e-spec.ts
```

## üìù Notes
- The default password for all seeded users is `Password123!`.
- The seed script uses a pre-calculated bcrypt hash to speed up execution.
